<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fart to the Finish: Real Clay Edition</title>
    <style>
        body {
            font-family: 'Comic Sans MS', sans-serif;
            background-color: #333; /* Dark background to make the board pop */
            display: flex;
            flex-direction: row;
            justify-content: center;
            align-items: flex-start;
            margin: 0;
            padding: 20px;
            gap: 20px;
        }

        /* --- THE BOARD IMAGE CONTAINER --- */
        #game-area {
            position: relative;
            /* Adjust this width to match your board image aspect ratio */
            width: 500px; 
            height: 900px; 
            box-shadow: 0 0 20px black;
            background-color: #fff;
        }

        #board-image {
            width: 100%;
            height: 100%;
            object-fit: fill; /* Stretches to fill the container */
            border-radius: 5px;
        }

        /* --- THE 3D PIECES --- */
        .token {
            position: absolute;
            width: 60px; /* Size of your clay pieces */
            height: 60px;
            transition: all 0.6s cubic-bezier(0.25, 1, 0.5, 1); /* Smooth movement */
            z-index: 10;
            
            /* THIS IS THE MAGIC 3D EFFECT */
            /* It looks at the shape of your PNG and adds a shadow behind it */
            filter: drop-shadow(5px 8px 4px rgba(0,0,0,0.6));
        }

        /* Slightly offset P2 so they don't perfectly overlap visually unless on same tile */
        #p2-token {
            z-index: 11; 
        }

        .chest-token {
            width: 50px;
            position: absolute;
            z-index: 5;
            filter: drop-shadow(3px 3px 3px rgba(0,0,0,0.6));
        }

        .shark-token {
            width: 70px;
            position: absolute;
            z-index: 4;
            filter: drop-shadow(2px 2px 2px rgba(0,0,0,0.4));
            /* We place the shark manually via code on the specific tile */
            display: none; 
        }

        /* --- CONTROLS SIDEBAR --- */
        .sidebar {
            background: white;
            padding: 20px;
            border-radius: 10px;
            width: 300px;
            text-align: center;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
        }

        #turn-indicator {
            padding: 10px; 
            color: white; 
            font-weight: bold; 
            border-radius: 5px;
            margin-bottom: 10px;
        }
        .bg-p1 { background-color: #555; }
        .bg-p2 { background-color: #76ff03; color: black !important; }

        #dice-box { font-size: 60px; margin: 20px 0; }
        
        button {
            padding: 15px 30px; font-size: 18px; cursor: pointer;
            background-color: orange; border: none; color: white; border-radius: 5px;
        }
        button:disabled { background-color: #ccc; }

        #message-log {
            margin-top: 15px; color: #d32f2f; font-weight: bold; min-height: 50px;
        }

        /* WHEEL MODAL (Same as before) */
        .modal {
            display: none; position: fixed; z-index: 100; left: 0; top: 0;
            width: 100%; height: 100%; background-color: rgba(0,0,0,0.8);
            justify-content: center; align-items: center;
        }
        .modal-content {
            background: white; padding: 20px; border-radius: 15px; text-align: center; position: relative;
        }
        #wheelCanvas { border-radius: 50%; transform: rotate(-90deg); }
        .arrow {
            position: absolute; top: 35px; left: 50%; transform: translateX(-50%);
            border-top: 20px solid black; border-left: 15px solid transparent; border-right: 15px solid transparent;
        }

        /* CALIBRATION HELPER */
        .calibration-dot {
            width: 10px; height: 10px; background: red; position: absolute; border-radius: 50%; pointer-events: none;
        }
    </style>
</head>
<body>

    <div id="game-area">
        <!-- YOUR BOARD IMAGE GOES HERE -->
        <!-- Clicking the board prints coordinates to Console (F12) for calibration -->
        <img src="board.jpg" id="board-image" onclick="getClickCoordinates(event)">
        
        <!-- The Players (Using Real Images) -->
        <img src="crowbar.png" class="token" id="p1-token" style="top:90%; left:20%">
        <img src="fart.png" class="token" id="p2-token" style="top:90%; left:60%">
        
        <!-- Items -->
        <img src="chest.png" class="chest-token" id="chest-token" style="display:none">
        <img src="shark.png" class="shark-token" id="shark-token">
    </div>

    <div class="sidebar">
        <h1>Fart to the Finish</h1>
        <div id="turn-indicator" class="bg-p1">Criminal's Turn</div>
        <div id="dice-box">üé≤</div>
        <button onclick="rollDice()" id="roll-btn">ROLL DIE</button>
        <div id="message-log">Click board to calibrate positions if needed!<br><br>Race to the finish!</div>
        <hr>
        <p>ü™ô Criminal Coins: <span id="p1-coins">0</span></p>
        <p>ü™ô Fart Coins: <span id="p2-coins">0</span></p>
    </div>

    <!-- WHEEL MODAL -->
    <div id="wheel-modal" class="modal">
        <div class="modal-content">
            <h2>‚òÆÔ∏è Peace Spin! ‚òÆÔ∏è</h2>
            <div class="arrow"></div>
            <canvas id="wheelCanvas" width="300" height="300"></canvas>
            <br><br>
            <button onclick="spinWheel()" id="spin-btn">SPIN</button>
            <p id="wheel-result"></p>
        </div>
    </div>

    <script>
        // --- COORDINATE MAPPING ---
        // This is the most important part.
        // We define 'Top' and 'Left' percentages for every one of the 16 squares.
        // Since I can't see your crop, I have guessed a standard Zig-Zag pattern.
        // You can update these numbers!
        const tileCoords = [
            { t: 90, l: 25 }, // 0: Start (Bottom Left)
            { t: 90, l: 75 }, // 1: Bottom Right
            { t: 78, l: 75 }, // 2: Row 2 Right
            { t: 78, l: 25 }, // 3: Row 2 Left
            { t: 66, l: 25 }, // 4: Row 3 Left
            { t: 66, l: 75 }, // 5: Row 3 Right
            { t: 54, l: 75 }, // 6: Row 4 Right
            { t: 54, l: 25 }, // 7: Row 4 Left
            { t: 42, l: 25 }, // 8: Row 5 Left
            { t: 42, l: 75 }, // 9: Row 5 Right
            { t: 30, l: 75 }, // 10: Row 6 Right
            { t: 30, l: 25 }, // 11: Row 6 Left
            { t: 18, l: 25 }, // 12: Row 7 Left
            { t: 18, l: 75 }, // 13: Row 7 Right
            { t: 6,  l: 75 }, // 14: Row 8 Right
            { t: 6,  l: 25 }  // 15: Finish (Top Left)
        ];

        // --- GAME DATA ---
        const boardData = [
            { type: "start" }, { type: "question" }, { type: "none" }, { type: "coin" },
            { type: "roll_again" }, { type: "roll_again" }, { type: "slide" }, { type: "boost" },
            { type: "peace" }, { type: "hazard" }, { type: "boost" }, { type: "none" },
            { type: "none" }, { type: "shark" }, { type: "none" }, { type: "finish" }
        ];

        // Variables
        let p1Pos = 0, p2Pos = 0, p1Coins = 0, p2Coins = 0;
        let currentTurn = 1, isGameOver = false;
        let chestPos = -1, chestCollected = false;

        // Elements
        const p1El = document.getElementById('p1-token');
        const p2El = document.getElementById('p2-token');
        const chestEl = document.getElementById('chest-token');
        const sharkEl = document.getElementById('shark-token');
        const msgEl = document.getElementById('message-log');
        const diceEl = document.getElementById('dice-box');
        const btnEl = document.getElementById('roll-btn');
        const turnEl = document.getElementById('turn-indicator');

        function initGame() {
            chestPos = Math.floor(Math.random() * 12) + 2;
            updateVisuals();
            placeStaticItems();
            drawWheel();
        }

        // --- CORE GAMEPLAY ---
        function rollDice() {
            if(isGameOver) return confirm("Restart?") ? location.reload() : null;
            
            btnEl.disabled = true;
            diceEl.innerText = "üîÑ";
            
            setTimeout(() => {
                let roll = Math.floor(Math.random() * 6) + 1;
                diceEl.innerText = roll;
                movePlayer(roll);
            }, 600);
        }

        function movePlayer(steps) {
            let cur = (currentTurn === 1) ? p1Pos : p2Pos;
            let next = Math.min(15, cur + steps);
            
            if (currentTurn === 1) p1Pos = next; else p2Pos = next;
            updateVisuals();

            setTimeout(handleLandEvent, 700);
        }

        function handleLandEvent() {
            let pos = (currentTurn === 1) ? p1Pos : p2Pos;
            let tile = boardData[pos];
            let msg = "";
            let endTurn = true;

            // Chest
            if(pos === chestPos && !chestCollected) {
                alert("You found the Treasure Chest!");
                addCoin(2);
                chestCollected = true;
                chestEl.style.display = 'none';
                btnEl.disabled = false;
                msgEl.innerText = "Treasure found! Roll again!";
                return;
            }

            // Suffocation Rule
            if(p2Pos === p1Pos && p2Pos > 0) {
                isGameOver = true;
                msgEl.innerHTML = "ü§¢ SUFFOCATION!<br>The Fart landed on the Criminal!<br>P2 WINS!";
                return;
            }

            // Finish
            if(pos === 15) {
                isGameOver = true;
                msgEl.innerHTML = (currentTurn===1) ? "Crowbar Escaped! P1 WINS!" : "Fart Crossed the Line! P2 WINS!";
                return;
            }

            // Tile Types
            if(tile.type === 'peace') {
                document.getElementById('wheel-modal').style.display = 'flex';
                return;
            }
            if(tile.type === 'slide') { shiftPlayer(-2); msg = "Slid back 2!"; }
            else if(tile.type === 'boost') { shiftPlayer(1); msg = "Speed Boost!"; }
            else if(tile.type === 'shark') { shiftPlayer(-99); msg = "SHARK ATTACK! Start Over!"; }
            else if(tile.type === 'coin') { addCoin(1); msg = "Pizza Coin found!"; }
            else if(tile.type === 'roll_again') { msg = "Roll Again!"; endTurn = false; }
            else if(tile.type === 'hazard') {
                let c = (currentTurn === 1) ? p1Coins : p2Coins;
                if(c > 0) { addCoin(-1); msg = "Paid the ghost. Safe."; }
                else { shiftPlayer(-3); msg = "No Pizza? Go back 3!"; }
            }
            else if(tile.type === 'question') {
                if(prompt("Riddle: I have no nose, but I smell. What am I?")?.toLowerCase().includes("fart")) {
                    addCoin(1); msg = "Correct! +1 Coin";
                } else {
                    shiftPlayer(-1); msg = "Wrong! Back 1.";
                }
            } else {
                msg = "Safe.";
            }

            msgEl.innerText = msg;
            
            setTimeout(() => {
                // Check suffocation again after slides
                if(p2Pos === p1Pos && p2Pos > 0) {
                    isGameOver = true;
                    msgEl.innerHTML = "ü§¢ SUFFOCATION AFTER SLIDE!<br>P2 WINS!";
                    return;
                }
                if(endTurn) toggleTurn();
                else btnEl.disabled = false;
            }, 600);
        }

        // --- VISUALS & MAPPING ---
        function updateVisuals() {
            // Move P1
            let c1 = tileCoords[p1Pos];
            p1El.style.top = c1.t + "%";
            p1El.style.left = (c1.l - 5) + "%"; // Offset slightly left
            
            // Move P2
            let c2 = tileCoords[p2Pos];
            p2El.style.top = c2.t + "%";
            p2El.style.left = (c2.l + 5) + "%"; // Offset slightly right
        }

        function placeStaticItems() {
            // Place Shark on tile 13
            let sC = tileCoords[13];
            sharkEl.style.display = 'block';
            sharkEl.style.top = sC.t + "%";
            sharkEl.style.left = (sC.l + 10) + "%";

            // Place Chest
            let cC = tileCoords[chestPos];
            chestEl.style.display = 'block';
            chestEl.style.top = (cC.t - 2) + "%";
            chestEl.style.left = cC.l + "%";
        }

        function toggleTurn() {
            currentTurn = (currentTurn === 1) ? 2 : 1;
            turnEl.className = (currentTurn === 1) ? "bg-p1" : "bg-p2";
            turnEl.innerText = (currentTurn === 1) ? "Criminal's Turn" : "Fart's Turn";
            btnEl.disabled = false;
        }

        function shiftPlayer(n) {
            if(currentTurn === 1) p1Pos = Math.max(0, Math.min(15, p1Pos+n));
            else p2Pos = Math.max(0, Math.min(15, p2Pos+n));
            updateVisuals();
        }
        function addCoin(n) {
            if(currentTurn===1) p1Coins+=n; else p2Coins+=n;
            document.getElementById('p1-coins').innerText = p1Coins;
            document.getElementById('p2-coins').innerText = p2Coins;
        }

        // --- CALIBRATION TOOL ---
        // Click anywhere on the board image to see the coordinate in the console!
        function getClickCoordinates(event) {
            const rect = event.target.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const y = event.clientY - rect.top;
            
            // Calculate percentage
            const xPercent = Math.round((x / rect.width) * 100);
            const yPercent = Math.round((y / rect.height) * 100);
            
            console.log(`{ t: ${yPercent}, l: ${xPercent} },`);
            alert(`Coordinate: { t: ${yPercent}, l: ${xPercent} }`);
        }

        // --- WHEEL ---
        const ctx = document.getElementById('wheelCanvas').getContext('2d');
        const opts = ["End Hunger", "No Wars", "End Poverty", "Clean Water", "Free Pizza", "Peace"];
        const cols = ["#FF5733", "#33FF57", "#3357FF", "#FF33F6", "#F6FF33", "#33FFF6"];
        let angle = 0, speed = 0, spinning = false;

        function drawWheel() {
            let arc = (2*Math.PI)/opts.length;
            for(let i=0; i<opts.length; i++) {
                ctx.beginPath(); ctx.fillStyle=cols[i];
                ctx.moveTo(150,150); ctx.arc(150,150,140, angle+i*arc, angle+(i+1)*arc);
                ctx.fill(); ctx.stroke();
                ctx.save(); ctx.translate(150,150); ctx.rotate(angle+i*arc+arc/2);
                ctx.textAlign="right"; ctx.fillStyle="black"; ctx.font="bold 14px Arial";
                ctx.fillText(opts[i], 130, 5); ctx.restore();
            }
        }
        function spinWheel() {
            if(spinning) return; spinning=true; speed=0.5+Math.random();
            requestAnimationFrame(animWheel);
        }
        function animWheel() {
            angle+=speed; speed*=0.98; drawWheel();
            if(speed>0.002) requestAnimationFrame(animWheel);
            else {
                spinning=false; 
                document.getElementById('wheel-modal').style.display='none';
                addCoin(3); toggleTurn();
            }
        }

        // Start
        initGame();
    </script>
</body>
</html>